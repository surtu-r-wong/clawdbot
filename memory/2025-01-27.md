# 2025-01-27 Memory

## Git Repository Setup

### Repository
- **URL**: https://github.com/surtu-r-wong/clawdbot.git
- **SSH**: git@github.com:surtu-r-wong/clawdbot.git
- **Branch**: master
- **Status**: Active, first commit pushed

### Initial Commit
- Commit: 316dcce
- Message: "Initial commit: workspace setup and config"
- Files:
  - AGENTS.md
  - BOOTSTRAP.md
  - HEARTBEAT.md
  - IDENTITY.md
  - SOUL.md
  - TOOLS.md
  - USER.md
  - canvas/index.html
  - memory/2025-01-27.md

### SSH Configuration
- **Key type**: ed25519
- **Key path**: ~/.ssh/id_ed25519
- **Public key added to GitHub**: ✅
- **GitHub known_hosts configured**: ✅

### Collaboration Setup
Two-way collaboration ready:
- **Web Chat/Telegram**: Direct conversation in web chat interface
- **SSH**: Direct VPS access for file editing
- **Git**: Version control for all code and config changes

## Telegram Access Issue

### 问题
用户在 Telegram 上收到 "access not configured" 错误，需要配对代码批准访问。

### 根本原因
配置文件 `~/.clawdbot/clawdbot.json` 中缺少 `channels.telegram.allowlist` 字段。

### 解决方案
在 `channels.telegram` 配置中添加 `allowlist` 数组，包含用户 ID：
```json
"channels": {
  "telegram": {
    "enabled": true,
    "botToken": "...",
    "allowlist": ["7520690411"]  // 王小爷的 Telegram 用户 ID
  }
}
```

### 避免
- 运行 `clawdbot gateway restart` 后需要重启服务才能生效
- 运行 `clawdbot doctor` 可能会重置部分配置，需要检查 allowlist 是否还在
- 如果允许列表再次丢失，重新添加并重启 gateway

### 现状
- ✅ allowlist 已配置
- ✅ Telegram 通道正常工作
- ✅ 用户 ID: 7520690411 (@aNaS_64_TaS_64)
- ✅ 会话配置自动更新，回复目标正确设置

### Session Routing Issue
**原因：**
- 消息来源和回复目标配置不匹配
- 先在 webchat 中对话，会话配置被设置为 webchat
- 切换到 Telegram 时，回复目标没有立即更新
- 导致回复被发送到 webchat 而不是 Telegram

**解决：**
- 当用户从 Telegram 发送新消息时，系统自动更新了会话配置
- `deliveryContext.channel` 和 `lastChannel` 自动设置为 telegram
- 现在回复目标正确

**避免：**
- 系统应该自动处理这个问题
- 如果再次出现，检查会话配置中的 `deliveryContext.channel`

## Notes & Lists Created

### Files Created
- `notes/todo.md`: 待办提醒清单
- `notes/ideas.md`: 脑洞点子清单

### Git Push
- Commit: 7ceb99a
- Message: "Add todo and ideas lists"

### Usage
**待办清单：**
- 添加任务：告诉华生"添加到待办清单：xxx"
- 完成任务：告诉华生"完成：xxx"
- 查看清单：告诉华生"查看待办清单"

**脑洞清单：**
- 记录想法：告诉华生"记下来：xxx"
- 查看清单：告诉华生"查看脑洞清单"
- 标记实现：告诉华生"实现了：xxx"

## Doctor Operation Impact

### 问题发现
用户运行了多次 `clawdbot doctor` 操作，但华生没有记录下来。

### Doctor 影响
**时间**: 2026-01-28 01:44 UTC
**命令**: `clawdbot doctor`
**结果**:
- `wizard.lastRunAt`: "2026-01-28T01:44:32.377Z"
- `wizard.lastRunCommand`: "doctor"
- `web` 字段被清空为 `{}`

### 影响
- **Brave Search API key 丢失** - `web.braveApiKey` 配置被清空
- 导致 `web_search` 工具报错 `missing_brave_api_key`
- 需要手动添加回去

### 避免
运行 `clawdbot doctor` 时，它会：
1. 诊断配置问题
2. 可能重置部分配置（如 `web` 部分）
3. 修改 `wizard.lastRunAt` 时间戳

**建议：**
- 运行 doctor 后，检查关键配置是否还在
- 特别是 API keys（Brave Search、其他服务）
- 如果丢失，需要重新添加

### 现状
- ✅ 已记录此问题
- ✅ 需要修复 Brave API key 配置

## Model Performance & Requirements

### 问题
用户反馈 GLM-4.7 模型响应太慢（35-163 秒）。

### 诊断结果
- **网络**: ✅ 正常（ping 6ms）
- **内存**: ✅ 充足（6.7GB / 7.8GB）
- **磁盘**: ✅ 充足（89GB / 99GB）
- **Gateway**: ✅ 运行正常
- **问题**: GLM-4.7 模型本身响应慢

### 响应时间记录
- 35 秒
- 59 秒
- 48 秒
- 163 秒 ← 最慢的

### 用户需求
用户表示：
- "这些模型都太弱了，我们后面是要编程的"
- 需要的是**编程能力强**的模型，不是速度

### 推荐的强编程模型

**1. Claude 3.5 Sonnet** ⭐⭐⭐⭐⭐ 推荐
- 编程能力: 非常强
- 代码质量: 高
- 价格: 中等
- 适合: 复杂代码、架构设计、调试
- 长上下文: 200K tokens

**2. Claude 3 Opus**
- 编程能力: 最强
- 代码质量: 最高
- 价格: 高
- 适合: 最复杂的编程任务

**3. GPT-4o / GPT-4 Turbo**
- 编程能力: 非常强
- 代码质量: 高
- 价格: 中等
- 适合: 快速开发、简单到中等复杂度

**4. Codestral**
- 编程能力: 强
- 代码质量: 高
- 价格: 便宜
- 适合: 代码生成、修复

### 现状
- 等待用户选择模型并提供 API Key
- 用户优先考虑编程能力而非速度

### 2026-02-06 学习内容

**执行流程问题**：
- 反复犯错导致查询慢（实际查询只需几秒）
- 计算错误：60570 vs 6050（10倍差异），但没发现
- 不按规则执行：不读 SKILL.md、不筛选头寸名称、不验证数据
- 数据完整性检查不足：不检查平仓记录、不验证数据一致性

**低级错误原因**：
1. 不直接使用API数据，而是凭记忆输入数字
2. 不验证数据：不对比API返回和计算中使用的数字
3. 不检查异常：60570 vs 6050 是明显的10倍差异，却没发现
4. 不按步骤执行：跳过读 SKILL.md、数据完整性检查等步骤

**改进承诺**：
1. 每次查询前必须读 SKILL.md
2. 计算时每步都引用原始数据
3. 发现任何数据异常立即警告
4. 永远不合并账户，每个账户用自己的权益和盈亏
5. 按账号、头寸名称分别计算，不要混在一起
